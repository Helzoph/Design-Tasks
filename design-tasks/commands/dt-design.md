---
name: dt-design
description: Design-Tasks 开发模式的设计文档更新命令。执行理清需求 → 查找文档 → 更新设计文档的流程，适用于只需要更新设计文档的场景。
---

# Design-Tasks 开发模式：设计文档更新

我将协助您更新系统的设计蓝图文档。

## 设计文档的核心定位

**设计文档是系统的"最终状态蓝图"，不是调试手册或修改记录。**

- **只描述"应该是什么样子"**：文档内容必须是系统最终的、完全的设计状态
- **绝对不包含**：
  - 任何修改历史或变更对比
  - 调试过程、排查方法、错误分析
  - "为什么这样改"的原因解释
  - 开发过程中的思考或决策记录
- **确保完整性**：拿着这套设计文档，应该能够完全理解并复刻整个系统，包括所有数据结构和业务逻辑

## 工作流程

### 第 1 步：查找相关设计文档
我将调用 **file-searcher（Skill）** 扫描现有设计文档：

1. 扫描 docs/design 目录结构
2. 根据需求定位相关的设计文档
3. 了解当前系统的技术栈、架构和已有设计

这一步帮助我们避免重复询问已经在文档中存在的信息。

### 第 2 步：理清需求
基于第 1 步的结果，我将调用 **requirements-coordinator（Sub Agent）** 来理解您的需求。requirements-coordinator 会使用 **requirements-planner（Skill）** 来：

1. 分析您的开发需求或意图
2. 结合 file-searcher 返回的现有文档信息，避免重复询问已知的技术栈和架构
3. 如需要澄清，使用 AskUserQuestion 工具一次性提出所有必要问题
4. 设计至少两种可行的技术方案供您选择
5. 引导您确认选择方案后，进入下一步

### 第 3 步：更新设计蓝图
我将调用 **design-coordinator（Sub Agent）** 来更新设计文档。design-coordinator 会使用 **file-searcher（Skill）**、**researcher（Agent）** 和 **design-doc-writer（Skill）** 来：

1. 搜索需要更新的相关设计文档
2. 如需要，查询相关技术的最新信息和最佳实践
3. 基于确认的方案更新或创建设计文档
4. 使用统一的设计文档模板
5. 在 .design-update/ 目录记录更新历史
6. 确保文档内容纯粹性（只描述最终状态）
7. **更新 manifest.json**：生成或更新项目的索引地图

## 适用场景

`/dt-design` 命令适用于以下场景：
- 只需要更新或创建设计文档
- 不需要创建任务工单
- 设计方案的讨论和分析
- 架构调整和文档同步

## 核心约束

- **绝对禁止修改源代码**：我的工作范围严格限制在 `docs` 文件夹内
- **设计文档纯粹性**：docs/design 目录下的文档是系统的**最终状态蓝图**，只描述"应该是什么样子"
- **不创建任务工单**：此命令不会创建 docs/tasks 目录下的工单文件

## 核心原则

### 1. Design as SSOT
- 设计文档是 Single Source of Truth（单一真理来源）
- 所有实现必须严格遵循设计文档
- 禁止偏离设计的"自主创新"

### 2. 立法与执法分离
- `/dt-design` 负责立法（制定设计蓝图）
- 代码 Agent 负责执法（实现设计）
- 执法过程发现问题必须熔断并反馈

### 3. 上下文按需加载
- **manifest.json**：作为项目的"索引地图"，支持无状态 Agent 快速理解项目
- **精确引用**：通过 manifest.json 和文档内链接，精准定位相关文档
- **熔断机制**：确保设计文档的权威性，不允许实现偏离设计

### 4. 状态追踪
- manifest.json 的 `last_updated` 字段记录文档更新时间
- .design-update/ 目录记录详细的变更历史
- 后续的 `/dt-check` 命令基于这些信息验证一致性

## 项目文档结构

```
docs/
├── design/                 # 蓝图：系统应该是什么样子
│   ├── backend/            # 后端设计
│   └── frontend/           # 前端设计
└── .design-update/         # 设计文档更新记录
```

## 输出示例

完成工作后，我会提供以下格式的总结：

```
设计蓝图更新完成：
- 已更新：docs/design/frontend/Components/CommentForm.md
- 已创建：docs/design/backend/API-Reference/Comments.yaml
- 更新记录：.design-update/2025-11-13-design-updates.md
```

## 开始使用

请告诉我您的开发需求或意图，我将专注于更新设计文档。
