---
name: dt-check
description: Design-Tasks 开发模式的对齐检查命令。执行文档与代码对齐检查，确保设计文档的权威性，解决文档与代码漂移问题。
---

# Design-Tasks 开发模式：文档与代码对齐检查

我将协助您检查设计文档与代码实现的一致性，确保设计文档作为系统的权威来源。

## 设计文档的核心定位

**设计文档是系统的"最终状态蓝图"，是唯一的真理来源。**

- **Design as SSOT**：设计文档是 Single Source of Truth
- **立法与执法分离**：`/dt-design` 立法，代码 Agent 执法
- **执法发现问题必须熔断**：执行 Agent 发现问题时必须停止并反馈

## 工作流程

### 第 1 步：读取输入参数

支持两种检查模式：

1. **验收模式** - 输入：`task_id`
   - 检查特定工单的完成质量
   - 验证工单状态更新建议

2. **巡检模式** - 输入：`module_name`
   - 检查特定模块的设计与实现一致性
   - 发现潜在的文档与代码漂移

### 第 2 步：加载检查对象

**验收模式**：
1. 读取 `docs/tasks/{task_id}.md` 工单文件
2. 解析 YAML Frontmatter 中的 `status` 和 `linked_design` 字段
3. 确定关联的设计文档列表

**巡检模式**：
1. 读取 `docs/manifest.json` 获取项目索引地图
2. 定位 `module_name` 对应的设计文档路径
3. 加载该模块的所有设计文档

### 第 3 步：读取理论状态（设计文档）

读取关联的设计文档：
- 使用 Read 工具加载所有 `linked_design` 中列出的文档
- 理解设计的预期行为和接口规范
- 记录关键的业务逻辑和数据结构

### 第 4 步：读取实际状态（代码实现）

根据设计文档中的"涉及文件"列表，读取实际代码：
- 使用 Read 工具加载相关的源代码文件
- 分析当前的实现逻辑
- 识别与设计文档的差异点

### 第 5 步：执行 Diff 分析

对比设计与实现，识别差异：

**验收模式检查点**：
- 工单要求的功能是否完整实现
- 实现逻辑是否符合设计文档
- 测试是否覆盖主要场景
- 代码质量是否符合规范

**巡检模式检查点**：
- 代码实现是否偏离设计文档
- 是否存在未经设计的新功能
- 设计文档是否过时（代码已更新但文档未同步）
- 接口和数据结构是否一致

### 第 6 步：生成检查报告

根据检查结果生成详细报告：

**验收模式报告**：
```markdown
## 检查结果：验收通过/不通过

### 通过标准
- [ ] 所有设计功能已实现
- [ ] 实现逻辑符合设计文档
- [ ] 代码质量符合规范
- [ ] 测试覆盖充分

### 发现的问题
<详细列出发现的问题和位置>

### 建议操作
- 如果检查通过：建议将工单 YAML 的 `status` 更新为 `verified`
- 如果检查不通过：建议执行 `/dt-tasks` 修正代码
```

**巡检模式报告**：
```markdown
## 文档与代码漂移报告

### 漂移类型分析

#### 类型1：代码是新（用户手动修改）
- **现象**：代码实现超前于设计文档
- **建议**：执行 `/dt-design` 同步文档
- **影响**：设计文档需要更新以反映新实现

#### 类型2：实现偏差
- **现象**：代码实现不符合设计文档
- **建议**：执行 `/dt-tasks` 修正代码
- **影响**：需要调整代码以符合设计

#### 类型3：设计过时
- **现象**：设计文档描述的功能在代码中已不存在
- **建议**：执行 `/dt-design` 更新文档
- **影响**：需要删除或修改设计文档

### 详细差异列表
<逐一列出每个差异点及其位置>
```

## 适用场景

`/dt-check` 命令适用于以下场景：

- **验收工单**：验证任务工单的完成质量
- **质量保证**：定期检查设计与实现的一致性
- **问题排查**：发现和诊断文档与代码漂移问题
- **审计验证**：确保开发过程遵循设计文档

## 核心原则

### 1. Design as SSOT
- 设计文档是唯一的真理来源
- 代码实现必须符合设计文档
- 禁止偏离设计的"自主创新"

### 2. 立法与执法分离
- `/dt-design` 负责立法（制定设计）
- 代码 Agent 负责执法（实现设计）
- `/dt-check` 负责审计（验证一致性）

### 3. 熔断机制
- 如果发现实现无法符合设计，**立即停止**
- 如果发现设计文档逻辑有误，**立即停止**
- 反馈问题并建议运行 `/dt-design` 修正设计

### 4. 上下文按需加载
- 通过 `manifest.json` 快速理解项目结构
- 通过工单 YAML 的 `linked_design` 精准加载文档
- 避免无状态 Agent 的上下文缺失问题

## 使用方式

### 验收模式
```bash
/dt-check 003
```
检查任务工单 003 的完成质量

### 巡检模式
```bash
/dt-check order
```
检查 order 模块的设计与实现一致性

## 输出格式

完成检查后，我会提供以下格式的总结：

**验收模式**：
```
对齐检查完成（验收模式）：
- 检查工单：docs/tasks/003-feat-design-order-model.md
- 检查结果：通过/不通过
- 建议操作：将 status 更新为 verified / 执行 /dt-tasks 修正代码
```

**巡检模式**：
```
对齐检查完成（巡检模式）：
- 检查模块：order
- 漂移类型：代码是新 / 实现偏差 / 设计过时
- 建议操作：执行 /dt-design 同步文档 / 执行 /dt-tasks 修正代码
```

## 开始使用

请告诉我您要检查的 `task_id` 或 `module_name`，我将专注于验证设计与实现的一致性。
